<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Zebomba test</title>
    <link href="styles.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="container">
      <div class="overlay"></div>

      <div id="background"></div>

      <div id="decorations"></div>

      <div id="stairs"></div>

      <div id="text-first"></div>
      <div id="text-last"></div>

      <div id="dot-blue"></div>

      <div id="tree"></div>

      <div id="start"></div>

      <div id="dot-black1" class="dot-black"></div>
      <div id="dot-black2" class="dot-black"></div>

      <div id="dot-red1" class="dot-red"></div>
      <div id="dot-red2" class="dot-red"></div>
      <div id="dot-red3" class="dot-red"></div>
      <div id="dot-red4" class="dot-red"></div>
      <div id="dot-red5" class="dot-red"></div>
      <div id="dot-red6" class="dot-red"></div>
      <div id="dot-red7" class="dot-red"></div>
      <div id="dot-red8" class="dot-red"></div>
      <div id="dot-red9" class="dot-red"></div>

      <div id="dot-gray1" class="dot-gray"></div>
      <div id="dot-gray2" class="dot-gray"></div>
      <div id="dot-gray3" class="dot-gray"></div>
      <div id="dot-gray4" class="dot-gray"></div>
      <div id="dot-gray5" class="dot-gray"></div>
      <div id="dot-gray6" class="dot-gray"></div>
      <div id="dot-gray7" class="dot-gray"></div>
      <div id="dot-gray8" class="dot-gray"></div>
      <div id="dot-gray9" class="dot-gray"></div>
      <div id="dot-gray10" class="dot-gray"></div>
      <div id="dot-gray11" class="dot-gray"></div>
      <div id="dot-gray12" class="dot-gray"></div>
      <div id="dot-gray13" class="dot-gray"></div>
      <div id="dot-gray14" class="dot-gray"></div>
      <div id="dot-gray15" class="dot-gray"></div>
      <div id="dot-gray16" class="dot-gray"></div>
      <div id="dot-gray17" class="dot-gray"></div>
      <div id="dot-gray18" class="dot-gray"></div>
      <div id="dot-gray19" class="dot-gray"></div>
      <div id="dot-gray20" class="dot-gray"></div>
      <div id="dot-gray21" class="dot-gray"></div>
      <div id="dot-gray22" class="dot-gray"></div>
      <div id="dot-gray23" class="dot-gray"></div>
      <div id="dot-gray24" class="dot-gray"></div>
      <div id="dot-gray25" class="dot-gray"></div>
      <div id="dot-gray26" class="dot-gray"></div>
      <div id="dot-gray27" class="dot-gray"></div>
      <div id="dot-gray28" class="dot-gray"></div>
      <div id="dot-gray29" class="dot-gray"></div>
      <div id="dot-gray30" class="dot-gray"></div>
      <div id="dot-gray31" class="dot-gray"></div>
      <div id="dot-gray32" class="dot-gray"></div>
      <div id="dot-gray33" class="dot-gray"></div>
      <div id="dot-gray34" class="dot-gray"></div>
      <div id="dot-gray35" class="dot-gray"></div>
      <div id="dot-gray36" class="dot-gray"></div>
      <div id="dot-gray37" class="dot-gray"></div>
      <div id="dot-gray38" class="dot-gray"></div>
      <div id="dot-gray39" class="dot-gray"></div>
      <div id="dot-gray40" class="dot-gray"></div>

      <div id="girl" style="top: 438px; left: 434px">
        <img src="images/girl.png" />
      </div>

      <div class="avatars-container">
        <div class="avatars-wrapper">
          <div id="friend-avatar1" class="avatar">
            <div class="avatar-img">
              <img class="avatar-icon" src="images/avatar.png" />
            </div>
            <div id="plus"><img src="images/plus.png" /></div>
          </div>

          <div id="friend-avatar2" class="avatar">
            <div class="avatar-img">
              <img class="avatar-icon" src="images/avatar.png" />
            </div>
          </div>

          <div id="friend-avatar3" class="avatar">
            <div class="avatar-img">
              <img class="avatar-icon" src="images/avatar.png" />
            </div>
          </div>

          <div id="friend-avatar4" class="avatar">
            <div class="avatar-img">
              <img class="avatar-icon" src="images/avatar.png" />
            </div>
          </div>

          <div id="friend-avatar5" class="avatar">
            <div class="avatar-img">
              <img class="avatar-icon" src="images/avatar.png" />
            </div>
          </div>

          <div id="friend-avatar6" class="avatar">
            <div class="avatar-img">
              <img class="avatar-icon" src="images/avatar.png" />
            </div>
          </div>

          <div id="friend-avatar7" class="avatar">
            <div class="avatar-img"></div>
          </div>

          <div id="friend-avatar8" class="avatar">
            <div class="avatar-img"></div>
          </div>

          <div id="friend-avatar9" class="avatar">
            <div class="avatar-img"></div>
          </div>

          <div id="friend-avatar10" class="avatar">
            <div class="avatar-img"></div>
          </div>

          <div id="friend-avatar11" class="avatar">
            <div class="avatar-img"></div>
          </div>

          <div id="friend-avatar12" class="avatar">
            <div class="avatar-img"></div>
          </div>

          <div id="friend-avatar13" class="avatar">
            <div class="avatar-img"></div>
          </div>
        </div>
      </div>
      <div id="arrow"><img src="images/arrow.png" /></div>
      <div id="arrow2"><img src="images/arrow2.png" /></div>

      <button id="chat-btn"></button>

      <button id="univer">
        <img src="images/text-univer.png" />
      </button>

      <button id="rating">
        <img src="images/rating-btn.png" />
      </button>

      <button id="messages"></button>

      <canvas id="myCanvas" width="896" height="521"></canvas>

      <div class="dropdown-menu">
        <div id="rating-bg">
          <img src="images/ratingbg.png" />
        </div>

        <div id="close-btn">
          <img src="images/close.png" />
        </div>

        <div id="weekly">
          <img id="weekly-heading" src="images/Layer399.png" />
          <img src="images/layer-bright.png" />
        </div>

        <div id="common">
          <img id="common-heading" src="images/Layer396.png" />
          <img src="images/layer-bright.png" />
        </div>

        <div id="rating-heading">
          <img src="images/heading-text.png" />
        </div>

        <div id="rating-bg__small">
          <div id="table-heading">
            <img src="images/table-heading1.png" alt="" />
            <img src="images/table-heading2.png" alt="" />
            <img src="images/table-heading3.png" alt="" />
          </div>

          <ul id="rating-table"></ul>
        </div>
      </div>
    </div>
    <script type="module" src="data.js"></script>
    <script type="module">
      fetch("./data.js")
        .then((response) => response.text())
        .then((data) => {
          let newData = data.toString().slice(12);
          newData = JSON.parse(newData);
          let friends = [].concat(newData.friends);
          newData = [].concat(newData.rating);
          newData.sort((a, b) =>
            Number(a.points) < Number(b.points) ? 1 : -1
          );

          newData.forEach((user) => {
            appendUser(
              user,
              newData.indexOf(user),
              friends.some((friend) => friend.id === user.id)
            );
          });
        });

      let appendUser = (user, number, isFriend) => {
        let li = document.createElement("li");
        ratingsUl.appendChild(li);

        let userAvatar = document.createElement("img");
        let userName = document.createElement("p");
        let userNumber = document.createElement("p");
        let userScore = document.createElement("p");

        let userContainer = document.createElement("div");
        let nameContainer = document.createElement("div");

        li.appendChild(userContainer);
        li.appendChild(userScore);

        userContainer.appendChild(userNumber);
        userContainer.appendChild(nameContainer);

        nameContainer.appendChild(userAvatar);
        nameContainer.appendChild(userName);

        li.classList.add("rating-user");

        userAvatar.classList.add("user-avatar");
        userName.classList.add("user-name");
        userNumber.classList.add("user-number");
        userScore.classList.add("user-score");
        userContainer.classList.add("user-container");
        nameContainer.classList.add("name-container");

        userName.innerHTML = user.name + " " + user.lastName;
        userAvatar.src = `images${user.img.slice(1)}`;
        userNumber.innerHTML = number + 1;
        userScore.innerHTML = user.points;

        if (isFriend) {
          userName.style.color = "yellow";
        }
      };

      const ratingsUl = document.getElementById("rating-table");
      const canvas = document.getElementById("myCanvas");
      const ctx = canvas.getContext("2d");

      const girl = document.getElementById("girl");
      const univer = document.getElementById("univer");
      const rating = document.getElementById("rating");
      const overlay = document.querySelector(".overlay");
      const dropdownRating = document.querySelector(".dropdown-menu");
      const closeRatings = document.getElementById("close-btn");

      const img = new Image();
      img.src = "./images/path.png";
      img.onload = () => {
        ctx.drawImage(img, 0, 0);
      };

      let currentDot = 0;
      let currentSlide = 0;

      univer.onclick = () => {
        currentDot === 0 ? (currentDot = 1) : (currentDot += 1);

        switch (currentDot) {
          case 1:
            goToFirstDot(341, 410);
            break;
          case 2:
            goToSecondDot(267, 452);
            break;

          case 3:
            goToThirdDot(180, 472);
            break;
        }
      };

      rating.onclick = () => {
        overlay.classList.toggle("overlay-active");
        dropdownRating.classList.toggle("dropdown-menu__active");
      };

      overlay.onclick = () => {
        overlay.classList.remove("overlay-active");
        dropdownRating.classList.toggle("dropdown-menu__active");
      };

      closeRatings.onclick = () => {
        overlay.classList.remove("overlay-active");
        dropdownRating.classList.remove("dropdown-menu__active");
      };

      arrow.onclick = () => {
        currentSlide--;
        slide("left");
      };

      arrow2.onclick = () => {
        currentSlide++;
        slide("right");
      };

      let slideTransform = (x) => {
        let slides = document.querySelectorAll(".avatar");
        slides.forEach((slide) => {
          slide.style.transform = `translateX(${currentSlide * x}%)`;
        });
      };

      let slide = (side) => {
        if ((side === "left" && currentSlide > -5) || currentSlide === -5) {
          slideTransform(120);
        } else if (side === "left" && currentSlide < -5) {
          slideTransform(0);
          currentSlide = 0;
        } else if (
          (side === "right" && currentSlide < 5) ||
          currentSlide === 5
        ) {
          slideTransform(120);
        } else if (side === "right" && currentSlide > 5) {
          slideTransform(0);
          currentSlide = 0;
        }
      };

      let goToFirstDot = (targetX, targetY) => {
        let x, y;

        let timer = setInterval(() => {
          if (x !== targetX) {
            x = parseInt(girl.style.left);
            y = parseInt(girl.style.top);

            let nextX = x - 10;
            let nextY = (Math.PI / 2 - Math.atan(nextX)) * 2500;
            if (nextX < 0) {
              nextX = 0;
              x = targetX;
            } else if (nextY < 0) {
              nextY = 0;
              y = targetY;
            } else {
              x = nextX;
              y -= nextY;
            }

            if (x < targetX) {
              x = targetX;
              y = targetY;
            }

            if (y < targetY) {
              y = targetY - 10;
            }

            girl.style.left = `${x}px`;
            girl.style.top = `${y}px`;
          } else {
            clearInterval(timer);
          }
        }, 100);
      };

      let goToSecondDot = (targetX, targetY) => {
        let x, y;

        let timer = setInterval(() => {
          if (x !== targetX) {
            x = parseInt(girl.style.left);
            y = parseInt(girl.style.top);

            let nextX = x - 7;
            let nextY = y + 4;

            if (nextX < 0) {
              nextX = 0;
              x = targetX;
            } else if (nextY < 0) {
              nextY = 0;
              y = targetY;
            } else {
              x = nextX;
              y = nextY;
            }

            if (x < targetX) {
              x = targetX;
              y = targetY;
            }

            girl.style.left = `${x}px`;
            girl.style.top = `${y}px`;
          } else {
            clearInterval(timer);
          }
        }, 70);
      };

      let goToThirdDot = (targetX, targetY) => {
        let x, y;
        let timer = setInterval(() => {
          if (x !== targetX) {
            x = parseInt(girl.style.left);
            y = parseInt(girl.style.top);

            let nextX = x - 8;
            let nextY = y + 1.8;
            if (nextX < 0) {
              nextX = 0;
              x = targetX;
            } else if (nextY < 0) {
              nextY = 0;
              y = targetY;
            } else {
              x = nextX;
              y = nextY;
            }

            if (x < targetX) {
              x = targetX;
              y = targetY;
            }

            girl.style.left = `${x}px`;
            girl.style.top = `${y}px`;
          } else {
            clearInterval(timer);
          }
        }, 100);
      };
    </script>
  </body>
</html>
